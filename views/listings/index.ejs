<% layout("/layouts/boilerplate") %>

<style>

/* ================= GLOBAL ================= */

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  overflow-x: auto; /* allow horizontal scroll if needed */
}

/* ================= FILTER BAR ================= */

#filters {
  display: flex;
  flex-wrap: nowrap;         /* NEVER wrap */
  gap: 1.5rem;
  padding-bottom: 10px;
  align-items: center;
  overflow-x: auto;          /* scroll if small screen */
  white-space: nowrap;
  scrollbar-width: none;
}

#filters::-webkit-scrollbar {
  display: none;
}

.filter {
  text-align: center;
  opacity: 0.7;
  transition: 0.3s ease;
  min-width: 70px;
  flex-shrink: 0;
}

.filter:hover {
  opacity: 1;
  cursor: pointer;
  transform: scale(1.1);
}

.filter p {
  font-size: 0.75rem;
  margin-top: 5px;
}

.active-filter {
  opacity: 1;
  transform: scale(1.1);
  border-bottom: 2px solid #fe424d;
}

/* ================= TAX TOGGLE ================= */

.tax-toggle {
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 8px 14px;
  display: flex;
  align-items: center;
  white-space: nowrap;
  background: white;
  margin-left: auto;
}

/* ================= LISTING CARDS ================= */

.listing-card {
  border: none;
  border-radius: 15px;
  overflow: hidden;
  transition: 0.25s ease;
}

.listing-card:hover {
  transform: translateY(-4px);
}

.listing-card img {
  height: 20rem;          /* FIXED height */
  object-fit: cover;
  width: 100%;
  border-radius: 15px;
}

.tax-info {
  display: none;
}

</style>


<!-- ================= FILTER SECTION ================= -->

<div id="filters" class="mb-3">

  <a href="/listings?category=Trending<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Trending' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-fire"></i>
      <p>Trending</p>
    </div>
  </a>

  <a href="/listings?category=Rooms<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Rooms' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-bed"></i>
      <p>Rooms</p>
    </div>
  </a>

  <a href="/listings?category=Iconic cities<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Iconic cities' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-mountain-city"></i>
      <p>Iconic cities</p>
    </div>
  </a>

  <a href="/listings?category=Mountains<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Mountains' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-mountain"></i>
      <p>Mountains</p>
    </div>
  </a>

  <a href="/listings?category=Castles<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Castles' ? 'active-filter' : '' %>">
      <i class="fa-brands fa-fort-awesome"></i>
      <p>Castles</p>
    </div>
  </a>

  <a href="/listings?category=Amazing Pools<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Amazing Pools' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-person-swimming"></i>
      <p>Amazing Pools</p>
    </div>
  </a>

  <a href="/listings?category=Farm<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Farm' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-building-wheat"></i>
      <p>Farm</p>
    </div>
  </a>

  <a href="/listings?category=Camping<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Camping' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-tent"></i>
      <p>Camping</p>
    </div>
  </a>

  <a href="/listings?category=Arctic<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Arctic' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-igloo"></i>
      <p>Arctic</p>
    </div>
  </a>

  <a href="/listings?category=Hiking<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Hiking' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-person-hiking"></i>
      <p>Hiking</p>
    </div>
  </a>

  <a href="/listings?category=Beach<%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Beach' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-umbrella-beach"></i>
      <p>Beach</p>
    </div>
  </a>

  <!-- TAX TOGGLE -->
  <div class="tax-toggle">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="switchCheckDefault">
      <label class="form-check-label">
        Display total before taxes
      </label>
    </div>
  </div>

</div>


<!-- ================= LISTINGS ================= -->

<div class="row g-4 row-cols-3">

  <% if (allListings.length === 0) { %>
    <h4>No listings found.</h4>
  <% } %>

  <% for (let listing of allListings) { %>

    <div class="col">
      <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">

        <div class="card listing-card h-100">

          <img 
            src="<%= listing.image?.url || '/images/default.jpg' %>" 
            class="card-img-top"
            alt="<%= listing.title %>"
          />

          <div class="card-body">
            <p class="card-text mb-0">
              <b><%= listing.title %></b><br>
              &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
              <span class="tax-info"> +18% GST</span>
            </p>
          </div>

        </div>

      </a>
    </div>

  <% } %>

</div>


<script>
const taxSwitch = document.getElementById("switchCheckDefault");

taxSwitch.addEventListener("click", () => {
  const taxInfo = document.getElementsByClassName("tax-info");

  for (let info of taxInfo) {
    info.style.display = taxSwitch.checked ? "inline" : "none";
  }
});
</script>
