<%- include("../includes/navbar.ejs") %>
<%- include("../includes/flash.ejs") %>

<style>
/* ================= FILTER BAR ================= */

#filters {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  padding-bottom: 10px;
  align-items: center;
  scroll-behavior: smooth;
}

@media (max-width: 768px) {
  #filters {
    flex-wrap: nowrap;
    overflow-x: auto;
    white-space: nowrap;
    scrollbar-width: none;
  }

  #filters::-webkit-scrollbar {
    display: none;
  }
}

.filter {
  text-align: center;
  opacity: 0.7;
  transition: 0.3s ease;
  min-width: 70px;
  flex-shrink: 0;
}

.filter:hover {
  opacity: 1;
  cursor: pointer;
  transform: scale(1.1);
}

.filter p {
  font-size: 0.75rem;
  margin-top: 5px;
}

.active-filter {
  opacity: 1;
  transform: scale(1.1);
  border-bottom: 2px solid #fe424d;
}

/* ================= TAX TOGGLE ================= */

.tax-toggle {
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 8px 14px;
  display: flex;
  align-items: center;
  white-space: nowrap;
  background: white;
  margin-left: auto;
}

/* ================= LISTING CARDS ================= */

.listing-card {
  border: none;
  border-radius: 15px;
  overflow: hidden;
  transition: 0.25s ease;
}

.listing-card:hover {
  transform: translateY(-4px);
}

.listing-card img {
  border-radius: 15px;
  object-fit: cover;
  width: 100%;
}

@media (max-width: 768px) {
  .listing-card img {
    height: 16rem;
  }
}

@media (min-width: 992px) {
  .listing-card img {
    height: 20rem;
  }
}

.tax-info {
  display: none;
}
</style>

<!-- ================= FILTER SECTION ================= -->

<div id="filters" class="mb-3">

  <a href="/listings?category=Trending" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Trending' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-fire"></i>
      <p>Trending</p>
    </div>
  </a>

  <a href="/listings?category=Rooms" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Rooms' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-bed"></i>
      <p>Rooms</p>
    </div>
  </a>

  <a href="/listings?category=Beach" class="text-decoration-none text-dark">
    <div class="filter <%= selectedCategory === 'Beach' ? 'active-filter' : '' %>">
      <i class="fa-solid fa-umbrella-beach"></i>
      <p>Beach</p>
    </div>
  </a>

</div>

<!-- ================= LISTINGS ================= -->

<div class="row g-4 row-cols-1 row-cols-sm-2 row-cols-lg-3">

  <% if (allListings.length === 0) { %>
    <h4>No listings found.</h4>
  <% } %>

  <% for (let listing of allListings) { %>

    <div class="col">
      <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">

        <div class="card listing-card h-100">

          <img 
            src="<%= listing.image?.url || '/images/default.jpg' %>" 
            class="card-img-top"
            alt="<%= listing.title %>"
          />

          <div class="card-body">
            <p class="card-text mb-0">
              <b><%= listing.title %></b><br>
              â‚¹ <%= listing.price.toLocaleString("en-IN") %> / night
              <span class="tax-info"> +18% GST</span>
            </p>
          </div>

        </div>

      </a>
    </div>

  <% } %>

</div>

<script>
const taxSwitch = document.getElementById("switchCheckDefault");

if (taxSwitch) {
  taxSwitch.addEventListener("click", () => {
    const taxInfo = document.getElementsByClassName("tax-info");

    for (let info of taxInfo) {
      info.style.display = taxSwitch.checked ? "inline" : "none";
    }
  });
}
</script>

<%- include("../includes/footer.ejs") %>
